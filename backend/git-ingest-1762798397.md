# ğŸš€ Project Analysis Report

Directory structure for: backend

## ğŸ¯ LLM-Optimized Codebase Analysis

This document provides a comprehensive, structured analysis of the codebase optimized for 
Large Language Model (LLM) processing. The content is organized with semantic markup, 
proper syntax highlighting, and hierarchical structure for enhanced AI comprehension.

## ğŸ“‘ Table of Contents

- [ğŸ“Š Project Overview](#-project-overview)
- [ğŸ“ˆ Statistics](#-statistics)
- [ğŸ—ï¸ Directory Structure](#ï¸-directory-structure)
- [ğŸ“ Files by Category](#-files-by-category)
  - [ğŸŒ Web Frontend](#1f310-web-frontend)
  - [âš™ï¸ Data/Config](#2699-data-config)
- [ğŸ“‹ Complete File Listing](#-complete-file-listing)

## ğŸ“Š Project Overview

**Project:** `backend`  
**Path:** `/home/chaitanya/projects/RCE/backend`  
**Generated:** 2025-11-10T18:13:17.297Z  
**Total Files:** 6  
**Total Size:** 12 KB  

### ğŸ¯ Quick Summary

This document contains a comprehensive analysis of the **backend** project, 
including its complete directory structure and the full content of all text files. 
The content is organized in a hierarchical, LLM-friendly format with proper syntax 
highlighting and metadata for optimal AI processing.

## ğŸ“ˆ Statistics

### ğŸ“Š File Type Distribution

| Category | Files | Percentage |
| --- | --- | --- |
| Web Frontend | 5 | 83.3% |
| Data/Config | 1 | 16.7% |

### ğŸ’» Programming Languages

| Language | Files | Primary Category |
| --- | --- | --- |
| javascript | 5 | Web Frontend |
| json | 1 | Data/Config |

### ğŸ“ Size Analysis

- **Total Project Size:** 12 KB
- **Average File Size:** 2 KB
- **Text Files:** 6 (100.0%)

## ğŸ—ï¸ Directory Structure

```
â”œâ”€â”€ db
â”‚   â”œâ”€â”€ db.js
â”‚   â””â”€â”€ schema.js
â”œâ”€â”€ auth.js
â”œâ”€â”€ drizzle.config.js
â”œâ”€â”€ index.js
â””â”€â”€ package.json
```

## ğŸ“ Files by Category

### ğŸŒ Web Frontend

**Languages:** javascript  
**File Count:** 5

### âš™ï¸ Data/Config

**Languages:** json  
**File Count:** 1
## ğŸ“‹ Complete File Listing

The following section contains the complete content of all text files in the project, 
organized with proper syntax highlighting and metadata for optimal LLM processing.

### ğŸ“„ `auth.js`

**Path:** `auth.js`  
**Size:** 1.3 KB  
**Language:** javascript (medium confidence)  
**Category:** Web Frontend  
```javascript
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { db } from "./db/db.js";
import * as dotenv from "dotenv";

dotenv.config();

export const auth = betterAuth({
  database: drizzleAdapter(db, {
    provider: "pg",
  }),
  // âœ… Email & Password
  emailAndPassword: {
    enabled: true,
    requireEmailVerification: false,
    minPasswordLength: 8,
    maxPasswordLength: 128,
  },
  // âœ… Social Providers
  socialProviders: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID || "",
      clientSecret: process.env.GOOGLE_CLIENT_SECRET || "",
      enabled: !!process.env.GOOGLE_CLIENT_ID,
    },
  },
  // Session config
  session: {
    expiresIn: 60 * 60 * 24 * 7, // 7 days
    updateAge: 60 * 60 * 24, // 1 day
    cookieCache: {
      enabled: true,
      maxAge: 5 * 60,
    },
  },
  // Trusted origins
  trustedOrigins: [
    process.env.FRONTEND_URL || "http://localhost:5173",
    "http://localhost:5173",
  ],
  // Base URL
  baseURL: process.env.BASE_URL || "http://localhost:3000",
  // Secret key
  secret:
    process.env.BETTER_AUTH_SECRET ||
    "secret-key-min-32-characters-long-required",
  // Advanced options
  advanced: {
    cookieSameSite: "lax",
    cookieSecure: process.env.NODE_ENV === "production",
    clearSessionTokenOnSignOut: true,
  },
});
```

### ğŸ“„ `db.js`

**Path:** `db/db.js`  
**Size:** 606 B  
**Language:** javascript (medium confidence)  
**Category:** Web Frontend  
```javascript
import { drizzle } from "drizzle-orm/neon-http";
import { neon } from "@neondatabase/serverless";
import * as dotenv from "dotenv";
import * as schema from "./schema.js";

// Load environment variables
dotenv.config();

// Validate DATABASE_URL
if (!process.env.DATABASE_URL) {
  throw new Error("âŒ DATABASE_URL is not defined in .env file");
}

console.log(
  "âœ… DATABASE_URL loaded:",
  process.env.DATABASE_URL.substring(0, 30) + "...",
);

// Create Neon client
const sql = neon(process.env.DATABASE_URL);

// Create Drizzle instance with schema
export const db = drizzle({ client: sql, schema });
```

### ğŸ“„ `schema.js`

**Path:** `db/schema.js`  
**Size:** 2.1 KB  
**Language:** javascript (medium confidence)  
**Category:** Web Frontend  
```javascript
import { pgTable, text, timestamp, boolean } from "drizzle-orm/pg-core";

export const user = pgTable("user", {
  id: text("id").primaryKey(),
  name: text("name").notNull(),
  email: text("email").notNull().unique(),
  emailVerified: boolean("email_verified").default(false).notNull(),
  image: text("image"),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at")
    .defaultNow()
    .$onUpdate(() => /* @__PURE__ */ new Date())
    .notNull(),
});

export const session = pgTable("session", {
  id: text("id").primaryKey(),
  expiresAt: timestamp("expires_at").notNull(),
  token: text("token").notNull().unique(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at")
    .$onUpdate(() => /* @__PURE__ */ new Date())
    .notNull(),
  ipAddress: text("ip_address"),
  userAgent: text("user_agent"),
  userId: text("user_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
});

export const account = pgTable("account", {
  id: text("id").primaryKey(),
  accountId: text("account_id").notNull(),
  providerId: text("provider_id").notNull(),
  userId: text("user_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
  accessToken: text("access_token"),
  refreshToken: text("refresh_token"),
  idToken: text("id_token"),
  accessTokenExpiresAt: timestamp("access_token_expires_at"),
  refreshTokenExpiresAt: timestamp("refresh_token_expires_at"),
  scope: text("scope"),
  password: text("password"),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at")
    .$onUpdate(() => /* @__PURE__ */ new Date())
    .notNull(),
});

export const verification = pgTable("verification", {
  id: text("id").primaryKey(),
  identifier: text("identifier").notNull(),
  value: text("value").notNull(),
  expiresAt: timestamp("expires_at").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at")
    .defaultNow()
    .$onUpdate(() => /* @__PURE__ */ new Date())
    .notNull(),
});
```

### ğŸ“„ `drizzle.config.js`

**Path:** `drizzle.config.js`  
**Size:** 464 B  
**Language:** javascript (medium confidence)  
**Category:** Web Frontend  
```javascript
import { defineConfig } from "drizzle-kit";
import * as dotenv from "dotenv";

// Load environment variables
dotenv.config();

// Validate DATABASE_URL exists
if (!process.env.DATABASE_URL) {
  throw new Error("âŒ DATABASE_URL is not defined in .env file");
}

export default defineConfig({
  schema: "./db/schema.js",
  out: "./migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL,
  },
  verbose: true,
  strict: true,
});
```

### ğŸ“„ `index.js`

**Path:** `index.js`  
**Size:** 6.8 KB  
**Language:** javascript (medium confidence)  
**Category:** Web Frontend  
```javascript
import express from "express";
import path from "path";
import cors from "cors";
import { createRequire } from "module";
import { fileURLToPath } from "url";
import { dirname } from "path";

import { toNodeHandler } from "better-auth/node";
import { auth } from "./auth.js";
// ES Module compatibility
const require = createRequire(import.meta.url);
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Import utils
const {
  execShellCommand,
  createUser,
  deleteUser,
  killProcessGroup,
} = require("./utils.js");

import { v4 as uuidv4 } from "uuid";
import dotenv from "dotenv";

// Load environment variables
dotenv.config();

const app = express();

app.use(
  cors({
    origin: process.env.FRONTEND_URL || "http://localhost:5173",
    credentials: true,
    methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
    allowedHeaders: ["Content-Type", "Authorization"],
  }),
);
app.all("/api/auth/*", toNodeHandler(auth));
app.use(express.json());

app.get("/", (req, res) => {
  res.json({
    status: "Server is running",
    timestamp: new Date().toISOString(),
    database: process.env.DATABASE_URL ? "Connected" : "Not configured",
  });
});

app.post("/api/execute", async (req, res) => {
  console.log("\n=== NEW EXECUTION REQUEST ===");
  console.log("Language:", req.body.language);
  console.log("Code:", req.body.code);

  const { code, language } = req.body;

  if (!code || !language) {
    return res.status(400).json({ error: "Code and language are required" });
  }

  const execId = `exec_${uuidv4().replace(/-/g, "")}`;

  try {
    await createUser(execId);
    const userHomeDir = `/home/${execId}`;
    const tempDir = path.join(userHomeDir, "temp", execId);

    await execShellCommand(`sudo -u ${execId} mkdir -p ${tempDir}`);

    const escapedCode = code.replace(/'/g, "'\\''");

    let scriptContent = `#!/bin/bash\n`;

    // Memory limits per language
    let memoryLimit = "256M";
    let cpuQuota = "100%";

    switch (language.toLowerCase()) {
      case "java": {
        const className = "Main";
        const javaFilePath = path.join(tempDir, `${className}.java`);

        await execShellCommand(
          `echo '${escapedCode}' | sudo -u ${execId} tee ${javaFilePath} > /dev/null`,
        );

        memoryLimit = "512M";
        scriptContent += `
ulimit -t 10
ulimit -u 50
ulimit -f 10240
cd ${tempDir}
javac ${javaFilePath} 2>&1
java -Xmx256m -Xms64m -cp ${tempDir} ${className} 2>&1
`;
        break;
      }

      case "cpp":
      case "c++": {
        const cppFilePath = path.join(tempDir, "program.cpp");
        const executableFile = path.join(tempDir, "program");

        await execShellCommand(
          `echo '${escapedCode}' | sudo -u ${execId} tee ${cppFilePath} > /dev/null`,
        );

        memoryLimit = "256M";
        scriptContent += `
ulimit -t 10
ulimit -u 40
ulimit -f 10240
cd ${tempDir}
g++ -o ${executableFile} ${cppFilePath} 2>&1
${executableFile} 2>&1
`;
        break;
      }

      case "javascript":
      case "js": {
        const jsFilePath = path.join(tempDir, "script.js");

        await execShellCommand(
          `echo '${escapedCode}' | sudo -u ${execId} tee ${jsFilePath} > /dev/null`,
        );

        memoryLimit = "256M";
        scriptContent += `
ulimit -t 10
ulimit -u 40
ulimit -f 10240
cd ${tempDir}
/usr/bin/node --max-old-space-size=200 ${jsFilePath} 2>&1
`;
        break;
      }

      case "python3":
      case "python": {
        const pyFilePath = path.join(tempDir, "script.py");

        await execShellCommand(
          `echo '${escapedCode}' | sudo -u ${execId} tee ${pyFilePath} > /dev/null`,
        );

        memoryLimit = "256M";
        scriptContent += `
ulimit -t 10
ulimit -u 40
ulimit -f 10240
cd ${tempDir}
/usr/bin/python3 ${pyFilePath} 2>&1
`;
        break;
      }

      default:
        return res
          .status(400)
          .json({ error: `Unsupported language: ${language}` });
    }

    const scriptPath = path.join(tempDir, "execute.sh");
    const escapedScript = scriptContent.replace(/'/g, "'\\''");

    await execShellCommand(
      `echo '${escapedScript}' | sudo -u ${execId} tee ${scriptPath} > /dev/null`,
    );
    await execShellCommand(`sudo chmod +x ${scriptPath}`);

    console.log("Executing script with systemd-run...");

    const executeCommand = `sudo systemd-run \
      --uid=${execId} \
      --scope \
      --slice=user.slice \
      --property=MemoryMax=${memoryLimit} \
      --property=MemoryHigh=${memoryLimit} \
      --property=CPUQuota=${cpuQuota} \
      --property=TasksMax=50 \
      bash ${scriptPath}`;

    let output;
    try {
      output = await execShellCommand(executeCommand, {
        timeout: 15000,
        maxBuffer: 1024 * 1024,
        killSignal: "SIGKILL",
      });

      console.log("Execution successful!");
      console.log("Output:", output);
    } catch (execError) {
      console.error("Execution failed!");
      console.error("Error code:", execError.code);
      console.error("Error output:", execError.output || execError.message);

      if (execError.killed || execError.signal === "SIGKILL") {
        throw new Error(
          "Execution timeout: Your code took too long to execute (max 15 seconds)",
        );
      }

      if (execError.code === 137) {
        throw new Error(
          "Process killed: CPU time limit exceeded (max 10 seconds)",
        );
      }

      if (execError.output && execError.output.includes("memory")) {
        throw new Error("Out of memory: Your code used too much memory");
      }

      if (execError.output && execError.output.trim()) {
        const errorOutput = execError.output.trim();
        const lines = errorOutput.split("\n");
        const relevantError = lines
          .filter(
            (line) =>
              !line.includes("execute.sh: line") &&
              !line.includes("core dumped") &&
              !line.includes("Running scope") &&
              line.trim().length > 0,
          )
          .join("\n");

        if (relevantError) {
          throw new Error(relevantError);
        }
      }

      throw new Error(execError.message || "Code execution failed");
    }

    res.json({
      output: output || "Program executed successfully with no output",
      executionTime: new Date().toISOString(),
    });
  } catch (error) {
    console.error("Final error:", error.message);

    res.status(500).json({
      error: error.message || "An error occurred during code execution",
    });
  } finally {
    try {
      await deleteUser(execId);
    } catch (cleanupError) {
      console.error(`Cleanup error: ${cleanupError.message}`);
    }
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, "0.0.0.0", () => {
  console.log(`ğŸš€ Server running on http://localhost:${PORT}`);
  console.log(`ğŸŒ CORS enabled for all origins`);
  console.log(
    `ğŸ“Š Database: ${process.env.DATABASE_URL ? "âœ… Connected" : "âŒ Not configured"}`,
  );
});
```

### ğŸ“„ `package.json`

**Path:** `package.json`  
**Size:** 735 B  
**Language:** json (high confidence)  
**Category:** Data/Config  
```json
{
  "name": "worker",
  "version": "1.0.0",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "dev": "node index.js",
    "start": "node index.js",
    "db:generate": "drizzle-kit generate",
    "db:push": "drizzle-kit push",
    "db:migrate": "drizzle-kit migrate",
    "db:studio": "drizzle-kit studio",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "keywords": [],
  "description": "",
  "dependencies": {
    "@neondatabase/serverless": "^1.0.2",
    "better-auth": "^1.3.34",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "drizzle-orm": "^0.44.7",
    "express": "^4.21.0",
    "uuid": "^10.0.0"
  },
  "devDependencies": {
    "drizzle-kit": "^0.31.6"
  }
}
```

---

### ğŸ“Š Processing Summary

- **Files Processed:** 6
- **Files Skipped:** 0
- **Total Files:** 6
- **Concurrency Limit:** 1
